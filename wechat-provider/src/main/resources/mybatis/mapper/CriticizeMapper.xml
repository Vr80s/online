<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xczhihui.wechat.course.mapper.CriticizeMapper">


	<select id="selectCourseCriticize" resultType="com.xczhihui.wechat.course.model.Criticize">
		SELECT
		  c.id,
		  c.star_level,
		  c.`criticize_lable`,
		  c.`content`,
		  c.`create_time`,
		  c.`praise_sum`,
		  c.`overall_level`,
		  c.`content_level`,
		  c.`deductive_level`,
		  IF(LOCATE(#{userId},c.`praise_login_names`),TRUE,FALSE) isPraise,
		  ou.`small_head_photo` smallHeadPhoto,
		  ou.`name`
		FROM
		  `oe_criticize` c
		  JOIN `oe_user` ou
			ON c.`create_person` = ou.`id`
		WHERE c.status = 1
		  AND c.`is_delete` = 0
		  AND c.`course_id` = #{courseId}
	</select>

	<select id="selectCollectionCriticize" resultType="com.xczhihui.wechat.course.model.Criticize">
		SELECT
		  c.id,
		  c.star_level,
		  c.`criticize_lable`,
		  c.`content`,
		  c.`create_time`,
		  c.`praise_sum`,
		  c.`overall_level`,
		  c.`content_level`,
		  c.`deductive_level`,
		  IF(LOCATE(#{userId},c.`praise_login_names`),TRUE,FALSE) isPraise,
		  ou.`small_head_photo` smallHeadPhoto,
		  ou.`name`
		FROM
		  `oe_criticize` c
		  JOIN `oe_user` ou
			ON c.`create_person` = ou.`id`
		WHERE c.status = 1
		  AND c.`is_delete` = 0
		  AND c.`course_id` in
		<foreach collection="courseIds" index="index" item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
	</select>

	<select id="selectAnchorCriticize" resultType="com.xczhihui.wechat.course.model.Criticize">
		SELECT
		  c.id,
		  c.star_level,
		  c.`criticize_lable`,
		  c.`content`,
		  c.`create_time`,
		  c.`praise_sum`,
		  c.`overall_level`,
		  c.`content_level`,
		  c.`deductive_level`,
		  IF(LOCATE(#{userId},c.`praise_login_names`),TRUE,FALSE) isPraise,
		  ou.`small_head_photo` smallHeadPhoto,
		  ou.`name`
		FROM
		  `oe_criticize` c
		  JOIN `oe_user` ou
			ON c.`create_person` = ou.`id`
		WHERE c.status = 1
		  AND c.`is_delete` = 0
		  AND c.`user_id`=#{anchorUserId}
	</select>
	<select id="selectReplyByCriticizeId" resultType="com.xczhihui.wechat.course.model.Reply">
		select
		  re.`reply_content`,
		  ou.`name`
		from
		  `oe_reply` re
		  join `oe_user` ou
			ON re.`reply_user` = ou.`id`
		where re.`criticize_id` =  #{criticizeId}
	</select>
	<select id="hasCourse" resultType="integer">
		SELECT
		  count(*)
		from
		  apply_r_grade_course argc
		where argc.is_delete = 0
		  and argc.course_id = #{courseId}
		  and argc.user_id = #{userId}
	</select>
</mapper>